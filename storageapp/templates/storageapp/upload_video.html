{% extends 'storageapp/base.html' %}

{% block title %}Upload Videos{% endblock %}

{% block content %}
{% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-body p-5">
                <h2 class="text-center mb-4">
                    <i class="fas fa-upload text-primary"></i> Upload a Single Video
                </h2>
                <form method="post" enctype="multipart/form-data" id="single-upload-video-form">
                    {% csrf_token %}
                    {{ single_form.title.label_tag }}
                    {{ single_form.title }}
                    {{ single_form.description.label_tag }}
                    {{ single_form.description }}
                    {{ single_form.video_file.label_tag }}
                    {{ single_form.video_file }}
                    {{ single_form.thumbnail.label_tag }}
                    {{ single_form.thumbnail }}
                    <label for="id_single_video_albums" class="form-label">Add to Albums</label>
                    {{ single_form.albums }}
                    <div class="form-text mb-2">Hold Ctrl (Windows) or Cmd (Mac) to select multiple albums.</div>
                    <div class="d-grid gap-2">
                        <button type="submit" name="single_upload" class="btn btn-primary btn-lg">
                            <i class="fas fa-check"></i> Upload Single Video
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="card shadow">
            <div class="card-body p-5">
                <h2 class="text-center mb-4">
                    <i class="fas fa-upload text-primary"></i> Upload Multiple Videos
                </h2>
                <!-- Drag and Drop Area -->
                <div id="video-drop-area" class="border border-2 border-primary rounded mb-3 p-4 text-center bg-light" style="cursor:pointer;">
                    <i class="fas fa-cloud-upload-alt fa-2x text-primary mb-2"></i>
                    <div>Drag & drop videos here, or click to select files</div>
                    <div id="video-drop-files" class="small text-muted mt-2"></div>
                </div>
                <form method="post" enctype="multipart/form-data" id="multi-upload-video-form">
                    {% csrf_token %}
                    {{ multi_form.title.label_tag }}
                    {{ multi_form.title }}
                    {{ multi_form.description.label_tag }}
                    {{ multi_form.description }}
                    <div class="mb-3">
                        <label for="id_videos" class="form-label">Select Videos</label>
                        <input type="file" name="videos" id="id_videos" multiple class="form-control" required style="display:none;">
                    </div>
                    <label for="id_multi_video_albums" class="form-label">Add to Albums</label>
                    {{ multi_form.albums }}
                    <div class="form-text mb-2">Hold Ctrl (Windows) or Cmd (Mac) to select multiple albums.</div>
                    <div class="d-grid gap-2">
                        <button type="submit" name="multi_upload" class="btn btn-success btn-lg">
                            <i class="fas fa-check"></i> Upload Multiple Videos
                        </button>
                        <a href="{% url 'videos' %}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Spinner Overlay -->
<div id="upload-video-spinner-overlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.7);z-index:9999;align-items:center;justify-content:center;">
    <div class="spinner-border text-primary" style="width:4rem;height:4rem;" role="status">
        <span class="visually-hidden">Uploading...</span>
    </div>
    <div class="mt-3 text-primary h4">Uploading, please wait...</div>
</div>
<script>
function showUploadVideoSpinner() {
    document.getElementById('upload-video-spinner-overlay').style.display = 'flex';
}
document.getElementById('single-upload-video-form').addEventListener('submit', showUploadVideoSpinner);
document.getElementById('multi-upload-video-form').addEventListener('submit', showUploadVideoSpinner);

// Drag and Drop for Videos
const videoDropArea = document.getElementById('video-drop-area');
const videoInput = document.getElementById('id_videos');
const videoDropFiles = document.getElementById('video-drop-files');
videoDropArea.addEventListener('click', () => videoInput.click());
videoDropArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    videoDropArea.classList.add('bg-primary', 'text-white');
});
videoDropArea.addEventListener('dragleave', (e) => {
    e.preventDefault();
    videoDropArea.classList.remove('bg-primary', 'text-white');
});
videoDropArea.addEventListener('drop', (e) => {
    e.preventDefault();
    videoDropArea.classList.remove('bg-primary', 'text-white');
    videoInput.files = e.dataTransfer.files;
    showVideoDropFiles();
});
videoInput.addEventListener('change', showVideoDropFiles);
function showVideoDropFiles() {
    if (videoInput.files.length > 0) {
        let names = Array.from(videoInput.files).map(f => f.name).join(', ');
        videoDropFiles.textContent = 'Selected: ' + names;
    } else {
        videoDropFiles.textContent = '';
    }
}
</script>
{% endblock %}